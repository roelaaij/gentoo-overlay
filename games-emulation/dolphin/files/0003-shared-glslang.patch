From aa8c20713f5307a509d9f48e781fef54bd435fe8 Mon Sep 17 00:00:00 2001
From: Roel Aaij <roel.aaij@gmail.com>
Date: Sat, 1 Nov 2025 21:20:14 +0100
Subject: [PATCH] system glslang

---
 CMakeLists.txt                                |   2 +-
 .../Core/VideoBackends/Vulkan/CMakeLists.txt  |   1 -
 Source/Core/VideoCommon/CMakeLists.txt        |   1 +
 Source/Core/VideoCommon/Spirv.cpp             | 119 +-----------------
 4 files changed, 4 insertions(+), 119 deletions(-)

diff --git a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
index 5f5583f2b0..8a165fc68d 100644
--- a/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
+++ b/Source/Core/VideoBackends/Vulkan/CMakeLists.txt
@@ -41,7 +41,6 @@ target_link_libraries(videovulkan
 PUBLIC
   common
   videocommon
-
 PRIVATE
   xxhash::xxhash
 )
diff --git a/Source/Core/VideoCommon/CMakeLists.txt b/Source/Core/VideoCommon/CMakeLists.txt
index fb9cba4fa4..dfba855023 100644
--- a/Source/Core/VideoCommon/CMakeLists.txt
+++ b/Source/Core/VideoCommon/CMakeLists.txt
@@ -226,6 +226,7 @@ PRIVATE
   imgui
   implot
   glslang::SPIRV
+  glslang::glslang-default-resource-limits
   tinygltf
 )

diff --git a/Source/Core/VideoCommon/Spirv.cpp b/Source/Core/VideoCommon/Spirv.cpp
index 59bc872f93..b94cbefc8e 100644
--- a/Source/Core/VideoCommon/Spirv.cpp
+++ b/Source/Core/VideoCommon/Spirv.cpp
@@ -5,6 +5,7 @@

 #include <glslang/SPIRV/GlslangToSpv.h>
 #include <glslang/SPIRV/disassemble.h>
+#include "glslang/Public/ResourceLimits.h"

 #include "Common/FileUtil.h"
 #include "Common/Logging/Log.h"
@@ -37,123 +38,7 @@ bool InitializeGlslang()

 const TBuiltInResource* GetCompilerResourceLimits()
 {
-  static const TBuiltInResource default_resource = {
-      /* .MaxLights = */ 32,
-      /* .MaxClipPlanes = */ 6,
-      /* .MaxTextureUnits = */ 32,
-      /* .MaxTextureCoords = */ 32,
-      /* .MaxVertexAttribs = */ 64,
-      /* .MaxVertexUniformComponents = */ 4096,
-      /* .MaxVaryingFloats = */ 64,
-      /* .MaxVertexTextureImageUnits = */ 32,
-      /* .MaxCombinedTextureImageUnits = */ 80,
-      /* .MaxTextureImageUnits = */ 32,
-      /* .MaxFragmentUniformComponents = */ 4096,
-      /* .MaxDrawBuffers = */ 32,
-      /* .MaxVertexUniformVectors = */ 128,
-      /* .MaxVaryingVectors = */ 8,
-      /* .MaxFragmentUniformVectors = */ 16,
-      /* .MaxVertexOutputVectors = */ 16,
-      /* .MaxFragmentInputVectors = */ 15,
-      /* .MinProgramTexelOffset = */ -8,
-      /* .MaxProgramTexelOffset = */ 7,
-      /* .MaxClipDistances = */ 8,
-      /* .MaxComputeWorkGroupCountX = */ 65535,
-      /* .MaxComputeWorkGroupCountY = */ 65535,
-      /* .MaxComputeWorkGroupCountZ = */ 65535,
-      /* .MaxComputeWorkGroupSizeX = */ 1024,
-      /* .MaxComputeWorkGroupSizeY = */ 1024,
-      /* .MaxComputeWorkGroupSizeZ = */ 64,
-      /* .MaxComputeUniformComponents = */ 1024,
-      /* .MaxComputeTextureImageUnits = */ 16,
-      /* .MaxComputeImageUniforms = */ 8,
-      /* .MaxComputeAtomicCounters = */ 8,
-      /* .MaxComputeAtomicCounterBuffers = */ 1,
-      /* .MaxVaryingComponents = */ 60,
-      /* .MaxVertexOutputComponents = */ 64,
-      /* .MaxGeometryInputComponents = */ 64,
-      /* .MaxGeometryOutputComponents = */ 128,
-      /* .MaxFragmentInputComponents = */ 128,
-      /* .MaxImageUnits = */ 8,
-      /* .MaxCombinedImageUnitsAndFragmentOutputs = */ 8,
-      /* .MaxCombinedShaderOutputResources = */ 8,
-      /* .MaxImageSamples = */ 0,
-      /* .MaxVertexImageUniforms = */ 0,
-      /* .MaxTessControlImageUniforms = */ 0,
-      /* .MaxTessEvaluationImageUniforms = */ 0,
-      /* .MaxGeometryImageUniforms = */ 0,
-      /* .MaxFragmentImageUniforms = */ 8,
-      /* .MaxCombinedImageUniforms = */ 8,
-      /* .MaxGeometryTextureImageUnits = */ 16,
-      /* .MaxGeometryOutputVertices = */ 256,
-      /* .MaxGeometryTotalOutputComponents = */ 1024,
-      /* .MaxGeometryUniformComponents = */ 1024,
-      /* .MaxGeometryVaryingComponents = */ 64,
-      /* .MaxTessControlInputComponents = */ 128,
-      /* .MaxTessControlOutputComponents = */ 128,
-      /* .MaxTessControlTextureImageUnits = */ 16,
-      /* .MaxTessControlUniformComponents = */ 1024,
-      /* .MaxTessControlTotalOutputComponents = */ 4096,
-      /* .MaxTessEvaluationInputComponents = */ 128,
-      /* .MaxTessEvaluationOutputComponents = */ 128,
-      /* .MaxTessEvaluationTextureImageUnits = */ 16,
-      /* .MaxTessEvaluationUniformComponents = */ 1024,
-      /* .MaxTessPatchComponents = */ 120,
-      /* .MaxPatchVertices = */ 32,
-      /* .MaxTessGenLevel = */ 64,
-      /* .MaxViewports = */ 16,
-      /* .MaxVertexAtomicCounters = */ 0,
-      /* .MaxTessControlAtomicCounters = */ 0,
-      /* .MaxTessEvaluationAtomicCounters = */ 0,
-      /* .MaxGeometryAtomicCounters = */ 0,
-      /* .MaxFragmentAtomicCounters = */ 8,
-      /* .MaxCombinedAtomicCounters = */ 8,
-      /* .MaxAtomicCounterBindings = */ 1,
-      /* .MaxVertexAtomicCounterBuffers = */ 0,
-      /* .MaxTessControlAtomicCounterBuffers = */ 0,
-      /* .MaxTessEvaluationAtomicCounterBuffers = */ 0,
-      /* .MaxGeometryAtomicCounterBuffers = */ 0,
-      /* .MaxFragmentAtomicCounterBuffers = */ 1,
-      /* .MaxCombinedAtomicCounterBuffers = */ 1,
-      /* .MaxAtomicCounterBufferSize = */ 16384,
-      /* .MaxTransformFeedbackBuffers = */ 4,
-      /* .MaxTransformFeedbackInterleavedComponents = */ 64,
-      /* .MaxCullDistances = */ 8,
-      /* .MaxCombinedClipAndCullDistances = */ 8,
-      /* .MaxSamples = */ 4,
-      /* .maxMeshOutputVerticesNV = */ 256,
-      /* .maxMeshOutputPrimitivesNV = */ 512,
-      /* .maxMeshWorkGroupSizeX_NV = */ 32,
-      /* .maxMeshWorkGroupSizeY_NV = */ 1,
-      /* .maxMeshWorkGroupSizeZ_NV = */ 1,
-      /* .maxTaskWorkGroupSizeX_NV = */ 32,
-      /* .maxTaskWorkGroupSizeY_NV = */ 1,
-      /* .maxTaskWorkGroupSizeZ_NV = */ 1,
-      /* .maxMeshViewCountNV = */ 4,
-      /* .maxMeshOutputVerticesEXT = */ 256,
-      /* .maxMeshOutputPrimitivesEXT = */ 256,
-      /* .maxMeshWorkGroupSizeX_EXT = */ 128,
-      /* .maxMeshWorkGroupSizeY_EXT = */ 128,
-      /* .maxMeshWorkGroupSizeZ_EXT = */ 128,
-      /* .maxTaskWorkGroupSizeX_EXT = */ 128,
-      /* .maxTaskWorkGroupSizeY_EXT = */ 128,
-      /* .maxTaskWorkGroupSizeZ_EXT = */ 128,
-      /* .maxMeshViewCountEXT = */ 4,
-      /* .maxDualSourceDrawBuffersEXT = */ 1,
-
-      /* .limits = */
-      {
-          /* .nonInductiveForLoops = */ 1,
-          /* .whileLoops = */ 1,
-          /* .doWhileLoops = */ 1,
-          /* .generalUniformIndexing = */ 1,
-          /* .generalAttributeMatrixVectorIndexing = */ 1,
-          /* .generalVaryingIndexing = */ 1,
-          /* .generalSamplerIndexing = */ 1,
-          /* .generalVariableIndexing = */ 1,
-          /* .generalConstantMatrixVectorIndexing = */ 1,
-      }};
-  return &default_resource;
+  return GetDefaultResources();
 }

 std::optional<SPIRV::CodeVector>
--
2.51.1
